<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>sbwit的博客</title>
  
  <subtitle>干就完了</subtitle>
  <link href="https://www.sbwit.com/atom.xml" rel="self"/>
  
  <link href="https://www.sbwit.com/"/>
  <updated>2021-04-19T01:53:19.108Z</updated>
  <id>https://www.sbwit.com/</id>
  
  <author>
    <name>sbwit</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DEMO</title>
    <link href="https://www.sbwit.com/2017/12/13/yuque/DEMO/"/>
    <id>https://www.sbwit.com/2017/12/13/yuque/DEMO/</id>
    <published>2017-12-13T15:40:07.000Z</published>
    <updated>2021-04-19T01:53:19.108Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/131683/1618478553167-dcb6c430-0bca-48e3-a79a-5a44244cc36b.jpeg#height=215&id=fBaDt&margin=%5Bobject%20Object%5D&name=15.jpg&originHeight=860&originWidth=860&originalType=binary&size=80189&status=done&style=none&width=215" alt="15.jpg"></p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Blog CI/CD<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">,</span> repository_dispatch<span class="token punctuation">]</span><span class="token key atrule">jobs</span><span class="token punctuation">:</span>  <span class="token key atrule">blog-cicd</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Hexo blog build &amp; deploy    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">env</span><span class="token punctuation">:</span>      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai    <span class="token key atrule">steps</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout codes      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup node      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1      <span class="token key atrule">with</span><span class="token punctuation">:</span>        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'12.x'</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache node modules      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v1      <span class="token key atrule">with</span><span class="token punctuation">:</span>        <span class="token key atrule">path</span><span class="token punctuation">:</span> ~/.npm        <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> runner.os <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">        npm install hexo-cli -g        npm install yuque-hexo -g        npm install        yuque-hexo sync</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate files      <span class="token key atrule">run</span><span class="token punctuation">:</span> hexo generate    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy blog    <span class="token key atrule">evn</span><span class="token punctuation">:</span>      <span class="token key atrule">Github_Pages</span><span class="token punctuation">:</span> github.com/sbwit/sbwit.github.io        <span class="token key atrule">Github_Token</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> secrets.TOKEN_GITHUBAPI <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">        git clone "https://$&#123;Github_Pages&#125;" deploy_git        mv ./deploy_git/.git ./public/        cd ./public        git config user.name "sbwit"        git config user.email "17740857130@qq.com"        git add .        git commit -m "GitHub Actions Auto Builder at $(date +'%Y-%m-%d %H:%M:%S')"        git push --force --quiet "https://$&#123;Github_Token&#125;@$&#123;Github_Pages&#125;" master:master</span></code></pre><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># -*- coding: utf8 -*-</span>import requestsdef main_handler(event<span class="token punctuation">,</span> <span class="token key atrule">context)</span><span class="token punctuation">:</span>r = requests.post("https<span class="token punctuation">:</span>//api.github.com/repos/sbwit/sbwit.hexo/dispatches"<span class="token punctuation">,</span>json = <span class="token punctuation">&#123;</span><span class="token key atrule">"event_type"</span><span class="token punctuation">:</span> <span class="token string">"start"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>headers = <span class="token punctuation">&#123;</span>"User<span class="token punctuation">-</span>Agent"<span class="token punctuation">:</span><span class="token string">'curl/7.52.1'</span><span class="token punctuation">,</span><span class="token key atrule">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span><span class="token key atrule">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/vnd.github.everest-preview+json'</span><span class="token punctuation">,</span><span class="token key atrule">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'token GITHUB_TOKEN(自己的)'</span><span class="token punctuation">&#125;</span>)<span class="token key atrule">if r.status_code == 204</span><span class="token punctuation">:</span>return "This's OK<span class="token tag">!</span>"<span class="token key atrule">else</span><span class="token punctuation">:</span>return r.status_code</code></pre><p>官方的配置</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># workflow name</span><span class="token key atrule">name</span><span class="token punctuation">:</span> CI Hexo<span class="token comment"># master branch on push, auto run</span><span class="token key atrule">on</span><span class="token punctuation">:</span>  <span class="token key atrule">push</span><span class="token punctuation">:</span>    <span class="token key atrule">branches</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> master<span class="token key atrule">jobs</span><span class="token punctuation">:</span>  <span class="token key atrule">Deploy-Pages</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Hexo Public To Pages    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest    <span class="token key atrule">steps</span><span class="token punctuation">:</span>      <span class="token comment"># check it to your workflow can access it</span>      <span class="token comment"># from: https://github.com/actions/checkout</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout Repository master branch        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@master      <span class="token comment"># from: https://github.com/actions/setup-node</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Node.js 10.x        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@master        <span class="token key atrule">with</span><span class="token punctuation">:</span>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">"12.14"</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Git Infomation        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          git config --global user.name 'sbwit'           git config --global user.email '17740857130@163.com'</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Latest Commit Message        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          git log --pretty=format:"%s from Github Actions at `date +"%Y-%m-%d %H:%M:%S"`" --date=short -n 1 > commit-message.log</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Hexo Dependencies        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          npm install hexo-cli -g           npm install</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate public files        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          hexo clean hexo generate</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy To Github Pages        <span class="token key atrule">env</span><span class="token punctuation">:</span>          <span class="token key atrule">Github_Pages</span><span class="token punctuation">:</span> github.com/sbwit/sbwit.github.io          <span class="token key atrule">Github_Token</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> secrets.TOKEN_GITHUBAPI <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">          git clone https://$&#123;Github_Pages&#125; .github_pages           cd .github_pages           git checkout master           cd ../           mv .github_pages/.git/ ./public/           cd ./public/           git add .           git commit -F ../commit-message.log           git push --force --quiet "https://$&#123;Github_Token&#125;@$&#123;Github_Pages&#125;" master:master</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://cdn.nlark.com/yuque/0/2021/jpeg/131683/1618478553167-dcb6c430-0bca-48e3-a79a-5a44244cc36b.jpeg#height=215&amp;id=fBaDt&amp;marg</summary>
      
    
    
    
    <category term="Hexo" scheme="https://www.sbwit.com/categories/Hexo/"/>
    
    
    <category term="博客搭建" scheme="https://www.sbwit.com/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    <category term="Hexo" scheme="https://www.sbwit.com/tags/Hexo/"/>
    
    <category term="Github" scheme="https://www.sbwit.com/tags/Github/"/>
    
  </entry>
  
</feed>
